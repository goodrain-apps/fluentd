<source>
@type tail
format none
path ${SERVICE_LOGS}
path_key listen_path
pos_file /var/log/containers.pos
  <parse>
    @type none
  </parse>
tag ${SERVICE_NAME}_log
</source>

<match **>
@type elasticsearch
hosts ${ES_HOST}
port ${ES_PORT}
user ${ES_USERNAME}
password ${ES_PASSWORD}
index_name k8s_
log_level info
logstash_format false
include_tag_key true
  <buffer tag>
    @type file
    path /var/log/buffer/${SERVICE_NAME}.log
    chunk_limit_size 512M
    total_limit_size 64G
    queue_limit_length 256
    flush_interval 60s
    retry_max_times 30
    disable_retry_limit
    retry_wait 1s
    retry_max_times 20
  </buffer>
</match>
